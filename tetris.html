<script>
    const canvas = document.getElementById("tetrisCanvas");
    const ctx = canvas.getContext("2d");
  
    const COLS = 10;
    const ROWS = 20;
    const BLOCK_SIZE = 24;
  
    const COLORS = [
      null,
      "cyan",    // I
      "yellow",  // O
      "purple",  // T
      "green",   // S
      "red",     // Z
      "blue",    // J
      "orange"   // L
    ];
  
    const SHAPES = [
      [[1]][[1]][[1]][[1]],      // âœ… Corrected I-shape
      [[2, 2], [2, 2]],    // O-shape
      [[0, 3, 0], [3, 3, 3]], // T-shape
      [[0, 4, 4], [4, 4, 0]], // S-shape
      [[5, 5, 0], [0, 5, 5]], // Z-shape
      [[6, 0, 0], [6, 6, 6]], // J-shape
      [[0, 0, 7], [7, 7, 7]]  // L-shape
    ];
  
    let board = Array.from({ length: ROWS }, () => Array(COLS).fill(0));
    let currentPiece = null;
  
    function drawBlock(x, y, color) {
      ctx.fillStyle = color || "black";
      ctx.fillRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
      ctx.strokeStyle = "#000";
      ctx.strokeRect(x * BLOCK_SIZE, y * BLOCK_SIZE, BLOCK_SIZE, BLOCK_SIZE);
    }
  
    function drawBoard() {
      ctx.clearRect(0, 0, canvas.width, canvas.height);
  
      for (let y = 0; y < ROWS; y++) {
        for (let x = 0; x < COLS; x++) {
          drawBlock(x, y, COLORS[board[y][x]]);
        }
      }
  
      if (currentPiece) {
        drawPiece(currentPiece);
      }
    }
  
    function newPiece() {
      const type = Math.floor(Math.random() * SHAPES.length);
      return {
        type: type,
        shape: SHAPES[type],
        x: 4, // Start in middle
        y: 0
      };
    }
  
    function drawPiece(piece) {
      piece.shape.forEach((row, dy) => {
        row.forEach((val, dx) => {
          if (val) {
            drawBlock(piece.x + dx, piece.y + dy, COLORS[val]);
          }
        });
      });
    }
  
    function startTetris() {
      document.getElementById("landing").classList.remove("active");
      document.getElementById("tetris").classList.add("active");
  
      currentPiece = newPiece();
      drawBoard();
  
      setInterval(() => {
        currentPiece.y++;
        drawBoard();
      }, 500);
    }
  
    function backToLanding() {
      document.getElementById("tetris").classList.remove("active");
      document.getElementById("landing").classList.add("active");
    }
  
    document.addEventListener("keydown", e => {
      if (!currentPiece) return;
  
      if (e.key === "ArrowLeft") {
        currentPiece.x--;
      } else if (e.key === "ArrowRight") {
        currentPiece.x++;
      } else if (e.key === "ArrowUp") {
        const rotated = currentPiece.shape[0].map((_, i) =>
          currentPiece.shape.map(row => row[i])
        ).reverse();
        currentPiece.shape = rotated;
      }
  
      drawBoard();
    });
  
    // Manual draw once to confirm blocks appear
    window.onload = () => {
      currentPiece = newPiece();
      drawBoard();
    };
  </script>